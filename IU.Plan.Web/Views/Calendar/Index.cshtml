@model CalendarViewModel
@using IU.Plan.Web.Models

@{
    ViewBag.Title = "Календарь";

    var today = DateTime.Today;
    var currentDay = today.Day - 1;
    var count = 0;
}

@helper PrintEvents(int dayNumber, DateTime today)
{
    if (dayNumber < Model.Limit)
    {
        DateTime day = new DateTime(today.Year, today.Month, dayNumber, 0, 0, 0);

        var dayEvent = Model.Events.FirstOrDefault(evt => evt.StartDate == day);
        if (dayEvent != null)
        {
            <div>@dayEvent.Title</div>
        }
    }
}


<h2>Календарь</h2>

<div class="table-responsive">

    <table class="table table-bordered">
        <tr>
            <th>понедельник</th>
            <th>вторник</th>
            <th>среда</th>
            <th>четверг</th>
            <th>пятница</th>
            <th>суббота</th>
            <th>воскресенье</th>
        </tr>
        @for (int i = 0; i < Model.RowCount; i++)
        {
            <tr>
                @for (int j = 0; j < Model.ColCount; j++)
                {
                    var tdClass = count == currentDay
                        ? "bg-danger"
                        : "";

                    <td class="@(tdClass)">
                        @(count++ < Model.Limit ? $"{count}" : "")
                        @PrintEvents(count, today)
                    </td>
                }
            </tr>
        }
    </table>

</div>


<div>

</div>
